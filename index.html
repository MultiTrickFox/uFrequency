<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>uFrequency.Ai</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body style="
    cursor: auto;
    margin: 0;
    overflow-y: scroll;
    -webkit-user-select: none;
    ">
    <link rel="stylesheet" href="style.css">

    <label for="username">Username:</label> <input type="password" id="username" name="username" onchange="username=this.value">
    <label for="password">Password:</label> <input type="password" id="password" name="password" onchange="password=this.value">

    <img src="assets/plan.jpeg" alt="My Plan">

    <script>

        var username = 'Zer0'
        var password = 'none'

        //

        async function main() {
            
            

        }

        async function test() {

            let response_from_song = await fetch_recommend_from_song("tAGnKpE4NCI", 1, 1, 10)
            console.log('recommended from song:\n',response_from_song)

            let response_from_text = await fetch_recommend_from_text("rock song with distortion guitar", 1, 10)
            console.log('recommended from text:\n',response_from_text)

            let mp3_data = await fetch('https://cdn.pixabay.com/download/audio/2022/02/08/audio_b270bd6a3c.mp3?filename=yakaliyakali-18486.mp3')
            mp3_data = await mp3_data.arrayBuffer()
            let response_from_audio = await fetch_recommend_from_audio(mp3_data, "deneme.mp3", 1, 1, 10)
            console.log('recommended from audio:\n',response_from_audio)

            let response_playlists = await fetch_get_playlists()
            console.log('current playlists:\n',response_playlists)
            console.log('an example playlist:\n',response_playlists['plistkey'])
            console.log('an example playlist query:\n',response_playlists['plistkey'][0]) // the initial query
            console.log('an example playlist items:\n',response_playlists['plistkey'][1]) // the songs list

            //

            let response_playlist_identifier = await fetch_set_playlist("song_tAGnKpE4NCI", response_from_song.map(e => e[0]))
            console.log('added a playlist with id:\n',response_playlist_identifier)

            //

            await fetch_get_playlists()
            await fetch_remove_playlist(response_playlist_identifier)
            await fetch_get_playlists()

            //
            
            await fetch_insert_into_playlist('plistkey', ['deneme_song1', 'deneme_song2'], 1)
            await fetch_get_playlists()

            //

            await fetch_remove_from_playlist('plistkey', ['deneme_song1', 'deneme_song2'])
            await fetch_get_playlists()

            //

        }       

    </script>

    <script>

        const sleep = sec => new Promise(r => setTimeout(r, sec*1_000))

        //

        async function fetch_recommend_from_song(url, use_segments, use_deep_embed, n) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/recommend_from_song", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("url", url)
            xhr.setRequestHeader("use_segments", use_segments)
            xhr.setRequestHeader("use_deep_embed", use_deep_embed)
            xhr.setRequestHeader("n", n)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('recommend_from_song response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            response = eval(response.replace(/\)/g,']').replace(/\(/g,'['))
            return response
        }

        async function fetch_recommend_from_text(text, use_segments, n) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/recommend_from_text", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("text", text)
            xhr.setRequestHeader("use_segments", use_segments)
            xhr.setRequestHeader("n", n)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('recommend_from_text response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            response = eval(response.replace(/\)/g,']').replace(/\(/g,'['))
            return response
        }

        async function fetch_recommend_from_audio(audio, audio_name, use_segments, use_deep_embed, n) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("POST", "https://ufrequency.ai.ap.ngrok.io/recommend_from_audio", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("audio_name", audio_name)
            xhr.setRequestHeader("use_segments", use_segments)
            xhr.setRequestHeader("use_deep_embed", use_deep_embed)
            xhr.setRequestHeader("n", n)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('recommend_from_audio response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send(audio)
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            response = eval(response.replace(/\)/g,']').replace(/\(/g,'['))
            return response
        }

        //

        async function fetch_get_playlists() {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/playlist", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("cmd", "get")
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('get_playlists response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            return response
        }

        async function fetch_set_playlist(query, contents) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/playlist", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("cmd", "set")
            xhr.setRequestHeader("query", query)
            xhr.setRequestHeader("contents", contents)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('set_playlist response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            return response
        }

        async function fetch_remove_playlist(identifier) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/playlist", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("cmd", "remove")
            xhr.setRequestHeader("identifier", identifier)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('remove_playlist response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            return response
        }

        async function fetch_remove_from_playlist(identifier, contents) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/playlist", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("cmd", "remove_from")
            xhr.setRequestHeader("identifier", identifier)
            xhr.setRequestHeader("contents", contents)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('remove_from_playlist response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            return response
        }

        async function fetch_insert_into_playlist(identifier, contents, index) {
            let xhr = new XMLHttpRequest()
            let response
            xhr.open("GET", "https://ufrequency.ai.ap.ngrok.io/playlist", true)
            xhr.setRequestHeader("username", username)
            xhr.setRequestHeader("password", password)
            xhr.setRequestHeader("cmd", "insert_into")
            xhr.setRequestHeader("identifier", identifier)
            xhr.setRequestHeader("contents", contents)
            xhr.setRequestHeader("index", index)
            xhr.onreadystatechange = function() {
                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log('insert_into_playlist response:',xhr.responseText)
                    response = JSON.parse(xhr.responseText).answer
                }
            }
            xhr.send()
            while (xhr.readyState != XMLHttpRequest.DONE) await sleep(.1)
            return response
        }

        //

    </script>

    <script>

        test()

    </script>

</body>
</html>
